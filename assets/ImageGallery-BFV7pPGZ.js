import{r as g,j as t}from"./index-B_jaXqA0.js";import{s as l}from"./supabaseClient-BwQJSF8Y.js";const T=()=>{const[a,k]=g.useState([]),[o,f]=g.useState(0),[h,x]=g.useState([]),[y,j]=g.useState(""),[b,m]=g.useState(null);g.useEffect(()=>{(async()=>{var i;const r=await l.auth.getUser();if(!r.data)throw new Error("User not authenticated");const{data:s,error:n}=await l.from("mosque_images").select("image_url").eq("user_id",(i=r.data.user)==null?void 0:i.id);if(n){console.error(n.message);return}k(s.map(d=>d.image_url)),s.length>0&&await c(s[0].image_url)})()},[]);const c=async e=>{const{data:r,error:s}=await l.from("image_pins").select("*").eq("image_url",e);if(s){console.error(s.message);return}x(r.map(n=>({id:n.id,x:n.x,y:n.y,tag:n.tag})))},C=async(e,r,s)=>{var d;const n=a[o],i=await l.auth.getUser();if(!((d=i.data)!=null&&d.user)){console.error("User not authenticated");return}if(e.id){const{error:u}=await l.from("image_pins").update({x:r,y:s}).eq("id",e.id);u?console.error(u.message):(await c(n),m(null))}else{const{error:u}=await l.from("image_pins").insert([{image_url:n,x:r,y:s,tag:e.tag,user_id:i.data.user.id}]);u?console.error(u.message):(await c(n),m(null))}},I=async e=>{if(!e)return;const{error:r}=await l.from("image_pins").delete().eq("id",e);if(r)console.error("Error deleting pin:",r.message);else{const s=a[o];await c(s)}},P=()=>{x([...h,{tag:y}]),j("")},v=e=>{if(!b)return;const r=e.currentTarget.getBoundingClientRect(),s=e.clientX-r.left,n=e.clientY-r.top,i=s/r.width*100,d=n/r.height*100;C(b,i,d)},_=async()=>{const e=o===a.length-1?0:o+1;f(e),x([]),await c(a[e])},S=async()=>{const e=o===0?a.length-1:o-1;f(e),x([]),await c(a[e])};return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("h2",{children:"Your Uploaded Images"}),a.length>0?t.jsxs("div",{children:[t.jsxs("div",{style:{position:"relative",display:"inline-block",marginBottom:"20px",cursor:"pointer"},onClick:v,children:[t.jsx("img",{src:a[o],alt:`Uploaded ${o}`,style:{width:"100%",maxWidth:"800px",height:"auto"}}),h.map((e,r)=>e.x&&e.y?t.jsx("div",{style:{position:"absolute",top:`${e.y}%`,left:`${e.x}%`,transform:"translate(-50%, -50%)",width:"20px",height:"20px",backgroundColor:"red",borderRadius:"50%",animation:"blink 1s infinite",cursor:"pointer"},children:e.tag&&t.jsx("span",{style:{position:"absolute",top:"25px",left:"50%",transform:"translateX(-50%)",backgroundColor:"white",padding:"2px 5px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold",color:"black"},children:e.tag})},r):null)]}),t.jsxs("div",{children:[t.jsx("button",{onClick:S,style:p,children:"Previous"}),t.jsx("button",{onClick:_,style:p,children:"Next"})]}),t.jsxs("p",{children:["Image ",o+1," of ",a.length]}),t.jsx("input",{type:"text",placeholder:"Enter tag for pin",value:y,onChange:e=>j(e.target.value),style:{padding:"10px",marginTop:"10px"}}),t.jsx("button",{onClick:P,style:p,children:"Add Pin"}),t.jsx("h3",{children:"Pin List for Current Image"}),t.jsxs("table",{style:{width:"80%",margin:"20px auto",border:"1px solid black"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"Tag"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:h.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.id}),t.jsx("td",{children:e.tag}),t.jsxs("td",{children:[t.jsx("button",{onClick:()=>m(e),style:{padding:"5px 10px",backgroundColor:"blue",color:"white",border:"none",cursor:"pointer"},children:"Select for Pinning"}),t.jsx("button",{onClick:()=>I(e.id),style:{padding:"5px 10px",backgroundColor:"red",color:"white",border:"none",cursor:"pointer"},children:"Delete"})]})]},e.id))})]})]}):t.jsx("p",{children:"No images uploaded yet."})]})},p={padding:"10px 20px",margin:"10px",fontSize:"16px",cursor:"pointer"},w=document.createElement("style");w.innerHTML=`
  @keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0; }
    100% { opacity: 1; }
  }
`;document.head.appendChild(w);export{T as default};
