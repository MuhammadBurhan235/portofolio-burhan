import{r as n,j as e}from"./index-B_jaXqA0.js";import{f as F,B as R,C as $,a as ee,R as se,b as f,c as te,F as ae,S as A,d as D,e as I,L as ne}from"./Iconbar-SRpUxeUz.js";import{s as o}from"./supabaseClient-BwQJSF8Y.js";import{S as re,a as oe}from"./SidebarL-en0QB9Ya.js";import"./index-CsdNEvOK.js";/* empty css            */const me=()=>{const[h,d]=n.useState(null),[m,l]=n.useState(null),[T,c]=n.useState(null),[_,b]=n.useState(null),[B,j]=n.useState(null),[S,W]=n.useState([]),[M,U]=n.useState([]),[O,Q]=n.useState([]),[g,w]=n.useState(null),[p,G]=n.useState(null),[y,H]=n.useState([]),[x,C]=n.useState(""),[N,K]=n.useState([]);n.useEffect(()=>{(async()=>{const{data:t,error:a}=await o.from("user_roles").select("id").eq("role","admin");a?console.error("Error fetching admins:",a):K(t||[])})()},[]),n.useEffect(()=>{(async()=>{const{data:a}=await o.auth.getSession();w(a==null?void 0:a.session)})();const{data:t}=o.auth.onAuthStateChange((a,r)=>{(a==="SIGNED_IN"||a==="SIGNED_OUT")&&w(r)});return()=>{t==null||t.subscription.unsubscribe()}},[]);const Y=s=>{j(s),l(s==="signin"?e.jsx(A,{switchToSignup:v}):s==="signup"?e.jsx(D,{switchToLogin:E}):null)},v=()=>{l(e.jsx(D,{switchToLogin:E}))},E=()=>{l(e.jsx(A,{switchToSignup:v}))},z=async()=>{await o.auth.signOut(),l(null),j(null),window.location.replace("/portofolio-burhan/lphelpdesk")};n.useEffect(()=>{(async()=>{const{data:t,error:a}=await o.from("faq").select("*");if(a)console.error(a);else{W(t);const r={};t.forEach(i=>{r[i.category]||(r[i.category]=0),r[i.category]+=i.likes});const u=["All Category",...Object.entries(r).sort(([,i],[,Z])=>Z-i).map(([i])=>i)];Q(u),d(null),c(null),b("tulis")}})()},[]),n.useEffect(()=>{(async()=>{const{data:t,error:a}=await o.from("layanan").select("*");a?console.error(a):U(t)})()},[]);const J=async s=>{G(s),L(s)},L=async s=>{try{const{data:t,error:a}=await o.from("messages").select("question, answer").eq("chats_id",s).order("timestamp",{ascending:!0});a?(console.error("Error fetching message data:",a),alert("Error fetching message data: "+a.message)):H(t||[])}catch(t){console.error("Unexpected error:",t),alert("An unexpected error occurred while fetching message data.")}},P=async s=>{if(s.preventDefault(),p&&x)try{const{data:{user:t},error:a}=await o.auth.getUser();if(a){console.error("Error fetching user:",a),alert("Error fetching user information.");return}const r=N[Math.floor(Math.random()*N.length)],q=r?r.id:null,{error:u}=await o.from("messages").insert([{chats_id:p,customer_id:t==null?void 0:t.id,question:x,answer:null,admin_id:q}]);u?(console.error("Error sending message:",u),alert("Error sending message: "+u.message)):(C(""),L(p))}catch(t){console.error("Unexpected error:",t),alert("An unexpected error occurred while sending message.")}};n.useEffect(()=>{y&&c(e.jsxs("div",{className:"d-flex flex-column",style:{height:"450px",border:"1px solid #ccc",borderRadius:"10px",padding:"10px"},children:[e.jsx("div",{className:"flex-grow-1 overflow-auto mb-2",style:{maxHeight:"400px"},children:y.map((s,t)=>e.jsxs("div",{className:"mb-2",children:[s.question&&e.jsx("div",{className:"d-flex justify-content-end mb-1",children:e.jsxs("div",{className:"p-2 bg-primary text-white rounded",children:[e.jsx("strong",{children:"Customer:"})," ",s.question]})}),s.answer&&e.jsx("div",{className:"d-flex justify-content-start mb-1",children:e.jsxs("div",{className:"p-2 bg-secondary text-white rounded",children:[e.jsx("strong",{children:"Admin:"})," ",s.answer]})})]},t))}),e.jsxs(F,{onSubmit:P,className:"d-flex mt-2",children:[e.jsx(F.Control,{type:"text",placeholder:"Type a message",value:x,onChange:s=>C(s.target.value)}),e.jsx(R,{variant:"primary",type:"submit",className:"ms-2",children:"Kirim"})]})]}))},[y,x]);const V=s=>{b(s),s==="faq"?(d(e.jsx(re,{sidebarLData:O,handleClose:()=>k("left"),handleCategoryClick:X})),c(e.jsx(I,{faqs:S,selectedCategory:"All Category"}))):s==="layanan"?(d(null),c(e.jsx(ne,{layananData:M}))):s==="tulis"?(d(e.jsx(oe,{handleChatClick:J})),c(e.jsx("p",{className:"text-center",children:"Silahkan mulai chat atau pilih chat!"}))):(d(null),c(null))},X=s=>{c(e.jsx(I,{faqs:S,selectedCategory:s}))},k=s=>{s==="left"?d(null):s==="right"&&l(null)};return e.jsxs($,{fluid:!0,className:"vh-100 d-flex flex-column",style:{padding:"12px"},children:[e.jsx(ee,{user:g,handleLogout:z,handleButtonClick:Y,selectedButton:B}),e.jsxs(se,{className:"flex-grow-1",style:{padding:"12px"},children:[e.jsx(f,{className:"bg-secondary p-3 d-flex flex-column align-items-center",style:{borderRadius:"15px",minWidth:"56px",maxWidth:"56px"},children:e.jsx(te,{user:g,handleIconClick:V,selectedIcon:_})}),e.jsx(f,{className:"bg-light p-3",style:{borderRadius:"15px",marginRight:"12px",maxWidth:h?"210px":"0px",minWidth:h?"210px":"0px",transition:"max-width 0.3s ease-in-out, min-width 0.3s ease-in-out",overflow:"hidden",border:h?"solid 1px":"solid 0px"},children:h}),e.jsx(f,{className:"bg-light p-4",style:{border:"1px solid",borderRadius:"15px",overflowY:"auto",height:"100%"},children:T}),e.jsxs(f,{className:"bg-light p-3",style:{borderTopLeftRadius:"15px",borderBottomLeftRadius:"15px",marginLeft:"12px",maxWidth:m?"210px":"0px",minWidth:m?"210px":"0px",transition:"max-width 0.3s ease-in-out, min-width 0.3s ease-in-out",overflow:"hidden",border:m?"solid 1px":"solid 0px"},children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(R,{variant:"link",onClick:()=>k("right"),children:e.jsx(ae,{})})}),g?null:m]})]})]})};export{me as default};
