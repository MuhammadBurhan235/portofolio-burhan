import{r as o,b as x,j as e,c as f}from"./index-BEzqX440.js";import{f as he,g as W,C as $,B as v,F as H,N as B,h as A,a as xe,R as fe,b as w,c as ge,S as _,d as U,e as O,L as pe}from"./Iconbar-BZvpbMnc.js";import{s as m}from"./supabaseClient-CajM-psZ.js";import"./index-C4FrtlOO.js";/* empty css            */const k=o.forwardRef(({className:l,bsPrefix:s,as:t="div",...a},c)=>(s=x(s,"card-body"),e.jsx(t,{ref:c,className:f(l,s),...a})));k.displayName="CardBody";const M=o.forwardRef(({className:l,bsPrefix:s,as:t="div",...a},c)=>(s=x(s,"card-footer"),e.jsx(t,{ref:c,className:f(l,s),...a})));M.displayName="CardFooter";const Q=o.forwardRef(({bsPrefix:l,className:s,as:t="div",...a},c)=>{const n=x(l,"card-header"),u=o.useMemo(()=>({cardHeaderBsPrefix:n}),[n]);return e.jsx(he.Provider,{value:u,children:e.jsx(t,{ref:c,...a,className:f(s,n)})})});Q.displayName="CardHeader";const G=o.forwardRef(({bsPrefix:l,className:s,variant:t,as:a="img",...c},n)=>{const u=x(l,"card-img");return e.jsx(a,{ref:n,className:f(t?`${u}-${t}`:u,s),...c})});G.displayName="CardImg";const Y=o.forwardRef(({className:l,bsPrefix:s,as:t="div",...a},c)=>(s=x(s,"card-img-overlay"),e.jsx(t,{ref:c,className:f(l,s),...a})));Y.displayName="CardImgOverlay";const V=o.forwardRef(({className:l,bsPrefix:s,as:t="a",...a},c)=>(s=x(s,"card-link"),e.jsx(t,{ref:c,className:f(l,s),...a})));V.displayName="CardLink";const ye=W("h6"),z=o.forwardRef(({className:l,bsPrefix:s,as:t=ye,...a},c)=>(s=x(s,"card-subtitle"),e.jsx(t,{ref:c,className:f(l,s),...a})));z.displayName="CardSubtitle";const J=o.forwardRef(({className:l,bsPrefix:s,as:t="p",...a},c)=>(s=x(s,"card-text"),e.jsx(t,{ref:c,className:f(l,s),...a})));J.displayName="CardText";const je=W("h5"),K=o.forwardRef(({className:l,bsPrefix:s,as:t=je,...a},c)=>(s=x(s,"card-title"),e.jsx(t,{ref:c,className:f(l,s),...a})));K.displayName="CardTitle";const X=o.forwardRef(({bsPrefix:l,className:s,bg:t,text:a,border:c,body:n=!1,children:u,as:j="div",...y},C)=>{const g=x(l,"card");return e.jsx(j,{ref:C,...y,className:f(s,g,t&&`bg-${t}`,a&&`text-${a}`,c&&`border-${c}`),children:n?e.jsx(k,{children:u}):u})});X.displayName="Card";const S=Object.assign(X,{Img:G,Title:K,Subtitle:z,Body:k,Link:V,Text:J,Header:Q,Footer:M,ImgOverlay:Y}),Ce=({handleChatClick:l})=>{const[s,t]=o.useState([]),a=async()=>{try{const{data:n,error:u}=await m.from("chats").select("*").order("timestamp",{ascending:!1});u?(console.error("Error fetching chats:",u),alert(`Error fetching chats: ${u.message}`)):t(n||[])}catch(n){console.error("Unexpected error:",n),alert("An unexpected error occurred while fetching chats.")}},c=async()=>{try{const{data:{user:n}={user:null},error:u}=await m.auth.getUser();if(u){console.error("Error fetching user:",u),alert("Error fetching user information.");return}if(n){const{data:j,error:y}=await m.from("chats").insert([{customer_id:n.id,status:"open"}]).select();if(y)console.error("Error starting chat:",y),alert("Error starting chat: "+y.message);else{const C=j[0].id,{error:g}=await m.from("messages").insert([{chats_id:C,customer_id:n.id,question:null,answer:null,admin_id:null}]);g?(console.error("Error inserting message:",g),alert("Error starting chat: "+g.message)):(alert("Chat started!"),a())}}else alert("Please log in to start a chat.")}catch(n){console.error("Unexpected error:",n),alert("An unexpected error occurred. Please try again later.")}};return o.useEffect(()=>{a()},[]),e.jsxs($,{className:"my-4",children:[e.jsx("div",{className:"d-flex justify-content-center mb-4",children:e.jsx(v,{variant:"primary",onClick:c,children:"Start Chat"})}),e.jsx("h3",{className:"text-center mb-3",children:"Your Chats"}),s.length>0?e.jsx("div",{className:"d-flex flex-column",children:s.map(n=>e.jsx(S,{className:"mb-3 shadow-sm",onClick:()=>l(n.id),style:{cursor:"pointer"},children:e.jsxs(S.Body,{className:"d-flex flex-column",children:[e.jsx(S.Subtitle,{className:"mb-2 text-muted",children:new Date(n.timestamp).toLocaleString()}),e.jsxs(S.Text,{children:["Status: ",n.status]})]})},n.id))}):e.jsx("p",{className:"text-center",children:"No chats available."})]})},Ne=({sidebarLData:l,handleClose:s,handleCategoryClick:t})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(v,{variant:"link",onClick:s,children:e.jsx(H,{})})}),e.jsx(B,{className:"flex-column",children:l.map((a,c)=>e.jsx(B.Link,{href:"#item",className:"text-dark",onClick:()=>t(a),children:a},c))})]}),ke=()=>{const[l,s]=o.useState(null),[t,a]=o.useState(null),[c,n]=o.useState(null),[u,j]=o.useState(null),[y,C]=o.useState(null),[g,Z]=o.useState([]),[P,ee]=o.useState([]),[se,ae]=o.useState([]),[b,R]=o.useState(null),[E,te]=o.useState(null),[L,re]=o.useState([]),[N,F]=o.useState("");o.useEffect(()=>{(async()=>{const{data:d}=await m.auth.getSession();R(d==null?void 0:d.session)})();const{data:i}=m.auth.onAuthStateChange((d,h)=>{(d==="SIGNED_IN"||d==="SIGNED_OUT")&&R(h)});return()=>{i==null||i.subscription.unsubscribe()}},[]);const ne=r=>{C(r),a(r==="signin"?e.jsx(_,{switchToSignup:I}):r==="signup"?e.jsx(U,{switchToLogin:T}):null)},I=()=>{a(e.jsx(U,{switchToLogin:T}))},T=()=>{a(e.jsx(_,{switchToSignup:I}))},oe=async()=>{await m.auth.signOut(),a(null),C(null),window.location.replace("/portofolio-burhan/lphelpdesk")};o.useEffect(()=>{(async()=>{const{data:i,error:d}=await m.from("faq").select("*");if(d)console.error(d);else{Z(i);const h={};i.forEach(p=>{h[p.category]||(h[p.category]=0),h[p.category]+=p.likes});const ue=["All Category",...Object.entries(h).sort(([,p],[,me])=>me-p).map(([p])=>p)];ae(ue),s(null),n(null),j("tulis")}})()},[]),o.useEffect(()=>{(async()=>{const{data:i,error:d}=await m.from("layanan").select("*");d?console.error(d):ee(i)})()},[]);const le=async r=>{te(r),D(r)},D=async r=>{try{const{data:i,error:d}=await m.from("messages").select("question, answer").eq("chats_id",r).order("timestamp",{ascending:!0});d?(console.error("Error fetching message data:",d),alert("Error fetching message data: "+d.message)):re(i||[])}catch(i){console.error("Unexpected error:",i),alert("An unexpected error occurred while fetching message data.")}},ce=async r=>{if(r.preventDefault(),E&&N)try{const{data:{user:i},error:d}=await m.auth.getUser();if(d){console.error("Error fetching user:",d),alert("Error fetching user information.");return}const{error:h}=await m.from("messages").insert([{chats_id:E,customer_id:i==null?void 0:i.id,question:N,answer:null,admin_id:null}]);h?(console.error("Error sending message:",h),alert("Error sending message: "+h.message)):(alert("Message sent!"),F(""),D(E))}catch(i){console.error("Unexpected error:",i),alert("An unexpected error occurred while sending message.")}};o.useEffect(()=>{L&&n(e.jsxs("div",{children:[L.map((r,i)=>e.jsxs("div",{className:"mb-2",children:[r.question&&e.jsx("div",{className:"d-flex justify-content-end mb-1",children:e.jsxs("div",{className:"p-2 bg-primary text-white rounded",children:[e.jsx("strong",{children:"Question:"})," ",r.question]})}),r.answer&&e.jsx("div",{className:"d-flex justify-content-start mb-1",children:e.jsxs("div",{className:"p-2 bg-secondary text-white rounded",children:[e.jsx("strong",{children:"Answer:"})," ",r.answer]})})]},i)),e.jsxs(A,{onSubmit:ce,className:"d-flex mt-2",children:[e.jsx(A.Control,{type:"text",placeholder:"Type a message",value:N,onChange:r=>F(r.target.value)}),e.jsx(v,{variant:"primary",type:"submit",className:"ms-2",children:"Send"})]})]}))},[L,N]);const ie=r=>{j(r),r==="faq"?(s(e.jsx(Ne,{sidebarLData:se,handleClose:()=>q("left"),handleCategoryClick:de})),n(e.jsx(O,{faqs:g,selectedCategory:"All Category"}))):r==="layanan"?(s(null),n(e.jsx(pe,{layananData:P}))):r==="tulis"?s(e.jsx(Ce,{handleChatClick:le})):(s(null),n(null))},de=r=>{n(e.jsx(O,{faqs:g,selectedCategory:r}))},q=r=>{r==="left"?s(null):r==="right"&&a(null)};return e.jsxs($,{fluid:!0,className:"vh-100 d-flex flex-column",style:{padding:"12px"},children:[e.jsx(xe,{user:b,handleLogout:oe,handleButtonClick:ne,selectedButton:y}),e.jsxs(fe,{className:"flex-grow-1",style:{padding:"12px"},children:[e.jsx(w,{className:"bg-secondary p-3 d-flex flex-column align-items-center",style:{borderRadius:"15px",minWidth:"56px",maxWidth:"56px"},children:e.jsx(ge,{user:b,handleIconClick:ie,selectedIcon:u})}),e.jsx(w,{className:"bg-light p-3",style:{borderRadius:"15px",marginRight:"12px",maxWidth:l?"210px":"0px",minWidth:l?"210px":"0px",transition:"max-width 0.3s ease-in-out, min-width 0.3s ease-in-out",overflow:"hidden",border:l?"solid 1px":"solid 0px"},children:l}),e.jsx(w,{className:"bg-light p-4",style:{border:"1px solid",borderRadius:"15px",overflowY:"auto",height:"100%"},children:c}),e.jsxs(w,{className:"bg-light p-3",style:{borderTopLeftRadius:"15px",borderBottomLeftRadius:"15px",marginLeft:"12px",maxWidth:t?"210px":"0px",minWidth:t?"210px":"0px",transition:"max-width 0.3s ease-in-out, min-width 0.3s ease-in-out",overflow:"hidden",border:t?"solid 1px":"solid 0px"},children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(v,{variant:"link",onClick:()=>q("right"),children:e.jsx(H,{})})}),b?null:t]})]})]})};export{ke as default};
