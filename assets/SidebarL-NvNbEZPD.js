import{r as l,b as m,j as s,c as u}from"./index-C-evPQ9L.js";import{s as x}from"./supabaseClient-C11RAOtm.js";import{g as F,h as w,C as H,B as E,F as L,N as y}from"./Iconbar-DWF6Riuu.js";const j=l.forwardRef(({className:o,bsPrefix:e,as:a="div",...r},t)=>(e=m(e,"card-body"),s.jsx(a,{ref:t,className:u(o,e),...r})));j.displayName="CardBody";const v=l.forwardRef(({className:o,bsPrefix:e,as:a="div",...r},t)=>(e=m(e,"card-footer"),s.jsx(a,{ref:t,className:u(o,e),...r})));v.displayName="CardFooter";const k=l.forwardRef(({bsPrefix:o,className:e,as:a="div",...r},t)=>{const f=m(o,"card-header"),d=l.useMemo(()=>({cardHeaderBsPrefix:f}),[f]);return s.jsx(F.Provider,{value:d,children:s.jsx(a,{ref:t,...r,className:u(e,f)})})});k.displayName="CardHeader";const R=l.forwardRef(({bsPrefix:o,className:e,variant:a,as:r="img",...t},f)=>{const d=m(o,"card-img");return s.jsx(r,{ref:f,className:u(a?`${d}-${a}`:d,e),...t})});R.displayName="CardImg";const S=l.forwardRef(({className:o,bsPrefix:e,as:a="div",...r},t)=>(e=m(e,"card-img-overlay"),s.jsx(a,{ref:t,className:u(o,e),...r})));S.displayName="CardImgOverlay";const _=l.forwardRef(({className:o,bsPrefix:e,as:a="a",...r},t)=>(e=m(e,"card-link"),s.jsx(a,{ref:t,className:u(o,e),...r})));_.displayName="CardLink";const U=w("h6"),T=l.forwardRef(({className:o,bsPrefix:e,as:a=U,...r},t)=>(e=m(e,"card-subtitle"),s.jsx(a,{ref:t,className:u(o,e),...r})));T.displayName="CardSubtitle";const B=l.forwardRef(({className:o,bsPrefix:e,as:a="p",...r},t)=>(e=m(e,"card-text"),s.jsx(a,{ref:t,className:u(o,e),...r})));B.displayName="CardText";const q=w("h5"),I=l.forwardRef(({className:o,bsPrefix:e,as:a=q,...r},t)=>(e=m(e,"card-title"),s.jsx(a,{ref:t,className:u(o,e),...r})));I.displayName="CardTitle";const $=l.forwardRef(({bsPrefix:o,className:e,bg:a,text:r,border:t,body:f=!1,children:d,as:N="div",...c},i)=>{const n=m(o,"card");return s.jsx(N,{ref:i,...c,className:u(e,n,a&&`bg-${a}`,r&&`text-${r}`,t&&`border-${t}`),children:f?s.jsx(j,{children:d}):d})});$.displayName="Card";const C=Object.assign($,{Img:R,Title:I,Subtitle:T,Body:j,Link:_,Text:B,Header:k,Footer:v,ImgOverlay:S}),b=({handleChatClick:o})=>{const[e,a]=l.useState([]),[r,t]=l.useState(null),f=async()=>{const{data:{user:c}={user:null},error:i}=await x.auth.getUser();if(i){console.error("Error fetching user:",i),alert("Error fetching user information.");return}if(c){const{data:n,error:h}=await x.from("user_roles").select("role").eq("id",c.id).single();h?(console.error("Error fetching role:",h),alert("Error fetching role: "+h.message)):t((n==null?void 0:n.role)||null)}},d=async()=>{var c;try{if(r==="customer"){const{data:i,error:n}=await x.from("chats").select("*").eq("customer_id",(c=(await x.auth.getUser()).data.user)==null?void 0:c.id).order("timestamp",{ascending:!1});n?(console.error("Error fetching chats:",n),alert(`Error fetching chats: ${n.message}`)):a(i||[])}else if(r==="admin"){const{data:i,error:n}=await x.from("messages").select("chats_id, question, answer, timestamp").order("timestamp",{ascending:!1});if(n)console.error("Error fetching messages:",n),alert(`Error fetching messages: ${n.message}`);else{const h=i.reduce((p,g)=>(p.some(A=>A.chats_id===g.chats_id)||p.push(g),p),[]);a(h)}}}catch(i){console.error("Unexpected error:",i),alert("An unexpected error occurred while fetching chats.")}},N=async()=>{try{const{data:{user:c}={user:null},error:i}=await x.auth.getUser();if(i){console.error("Error fetching user:",i),alert("Error fetching user information.");return}if(c){const{data:n,error:h}=await x.from("chats").insert([{customer_id:c.id,status:"open"}]).select();if(h)console.error("Error starting chat:",h),alert("Error starting chat: "+h.message);else{const p=n[0].id,{error:g}=await x.from("messages").insert([{chats_id:p,customer_id:c.id,question:null,answer:null,admin_id:null}]);g?(console.error("Error inserting message:",g),alert("Error starting chat: "+g.message)):(alert("Chat started!"),d())}}else alert("Please log in to start a chat.")}catch(c){console.error("Unexpected error:",c),alert("An unexpected error occurred. Please try again later.")}};return l.useEffect(()=>{f()},[]),l.useEffect(()=>{r&&d()},[r]),s.jsxs(H,{className:"my-4",children:[r==="customer"&&s.jsx("div",{className:"d-flex justify-content-center mb-4",children:s.jsx(E,{variant:"primary",onClick:N,children:"Mulai Chat"})}),s.jsx("h3",{className:"text-center mb-3",children:"Chat KITA!"}),e.length>0?s.jsx("div",{className:"d-flex flex-column",children:e.map(c=>s.jsx(C,{className:"mb-3 shadow-sm",onClick:()=>o(c.chats_id||c.id),style:{cursor:"pointer"},children:s.jsxs(C.Body,{className:"d-flex flex-column",children:[s.jsx(C.Subtitle,{className:"mb-2 text-muted",children:new Date(c.timestamp).toLocaleString()}),r==="customer"?s.jsxs(C.Text,{children:["Status: ",c.status]}):s.jsxs(C.Text,{children:["Question: ",c.question]})]})},c.chats_id||c.id))}):r==="customer"?s.jsx("p",{className:"text-center",children:"Anda belum memiliki chat, silahkan Mulai Chat!"}):s.jsx("p",{className:"text-center",children:"Belum ada customer hari ini :("})]})},K=({sidebarLData:o,handleClose:e,handleCategoryClick:a})=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"d-flex justify-content-end",children:s.jsx(E,{variant:"link",onClick:e,children:s.jsx(L,{})})}),s.jsx(y,{className:"flex-column",children:o.map((r,t)=>s.jsx(y.Link,{href:"#item",className:"text-dark",onClick:()=>a(r),children:r},t))})]});export{K as S,b as a};
